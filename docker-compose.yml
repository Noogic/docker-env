version: '2'

services:

### Application Code Container ##############################
    volumes_source:
        build: ./volumes/application
        volumes:
            - ../:/var/www/app
            - ./volumes/log/nginx:/var/log/nginx
            - node_modules:/var/www/app/node_modules


### Databases Data Container ################################
    volumes_data:
        build: ./volumes/data
        volumes:
            - /var/lib/mysql:/var/lib/mysql
            - /var/lib/postgres:/var/lib/postgres
            - /var/lib/mariadb:/var/lib/mariadb
            - /var/lib/memcached:/var/lib/memcached
            - /var/lib/redis:/data
            - /var/lib/neo4j:/var/lib/neo4j/data
            - /var/lib/mongo:/data/db


### Workspace Utilities Container ###########################
    workspace:
        build: ./workspace
        volumes_from:
            - volumes_source
        tty: true


### Nginx Server Container ##################################
    nginx:
        build: ./nginx
        volumes_from:
            - volumes_source
        ports:
            - "80:80"
            - "443:443"
        links:
            - php-fpm
            - node-app


### PHP-FPM Container #######################################
    php-fpm:
        build:
            context: ./php-fpm
            dockerfile: Dockerfile-70
        volumes_from:
            - volumes_source
        expose:
            - "9000"
        links:
            - workspace


### Node Service Container ##################################
    node-app:
        build: ./node
        volumes_from:
            - volumes_source
        expose:
            - "3000"
        links:
            - workspace



volumes:
    node_modules:
